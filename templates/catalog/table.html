<div class="overflow-x-auto rounded-lg">
  <table class="table">
    <thead>
      <tr>
        <th scope="col"></th>
        <th scope="col">{{ translate["category"] }}</th>
        <th scope="col">{{ translate["layer-name"] }}</th>
        <th scope="col">{{ translate["alias"] }}</th>

        {% if !is_guest_or_non_admin %}
          <th scope="col">{{ translate["table"] }}</th>
        {% endif %}
        <th scope="col">Source</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      {% for layer in layers %}
      <tr>
        <td>
          <span class="icon__small text-blue-500">
            {% if layer.geometry == "polygons" %}
            <i class="fas fa-draw-polygon"></i>
            {% else if layer.geometry == "lines" %}
            <i class="fas fa-minus"></i>
            {% else %}
            <i class="fas fa-circle"></i>
            {% endif %}
          </span>
        </td>
        <td>{{ layer.category.name }}</td>
        <td>{{ layer.name }}</td>
        <td>{{ layer.alias }}</td>
        {% if !is_guest_or_non_admin %}
          <td>{{ layer.schema }}.{{ layer.table_name }}</td>
        {% endif %}
        <td class="text-blue-500">
          <span id="url-{{ layer.category.name }}:{{ layer.name }}">
            <span class="server"></span>/services/tiles/{{ layer.category.name
            }}:{{ layer.name }}/{z}/{x}/{y}.pbf
          </span>
        </td>

        <td class="text-right relative">
          <div class="flex justify-end">
            <div class="relative" data-dropdown="{{ layer.id }}">
              <button
                type="button"
                class="flex items-center justify-center w-10 h-10 rounded bg-zinc-100 text-zinc-900 hover:bg-zinc-200"
                onclick='toggleDropdown("{{ layer.id }}")'
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-ellipsis-h"></i>
              </button>

              <div
                id="dropdown-menu-{{ layer.id }}"
                class="hidden absolute right-0 mt-2 w-56 bg-white border rounded shadow-lg text-sm z-[999]"
                role="menu"
                aria-label="Actions menu"
              >
                <ul class="py-1">
                  <!-- Copiar -->
                  <li>
                    <button
                      type="button"
                      class="w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center space-x-2"
                      onclick='copyToClipboard("url-{{ layer.category.name }}:{{ layer.name }}"); closeDropdown("{{ layer.id }}")'
                      role="menuitem"
                      title='{{ translate["copy"] }}'
                    >
                      <span class="w-5"><i class="fas fa-copy"></i></span>
                      <span>{{ translate["copy"] }}</span>
                    </button>
                  </li>

                  <!-- Map para guest / non-admin -->
                  {% if is_guest_or_non_admin %}
                    <li>
                      {% if layer.published %}
                        <a
                          class="block px-3 py-2 hover:bg-gray-50 items-center space-x-2"
                          href='/maplayer/{{ layer.category.name }}:{{ layer.name }}'
                          target="_blank"
                          role="menuitem"
                          onclick='closeDropdown("{{ layer.id }}")'
                          title='{{ translate["map"] }}'
                        >
                          <span class="w-5"><i class="fas fa-map"></i></span>
                          <span>{{ translate["map"] }}</span>
                        </a>
                      {% else %}
                        <div
                          class="block w-full text-left px-3 py-2 items-center space-x-2 text-gray-400 cursor-not-allowed"
                          role="menuitem"
                          aria-disabled="true"
                          title='{{ translate["map"] }}'
                        >
                          <span class="w-5"><i class="fas fa-map"></i></span>
                          <span>{{ translate["map"] }}</span>
                        </div>
                      {% endif %}
                    </li>
                  {% endif %}

                  <!-- Admin actions -->
                  {% if let Some(current_user) = self.current_user %}
                    {% if current_user.is_admin() %}
                      <li>
                        <button
                          class="w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center space-x-2"
                          title='{{ translate["info"] }}'
                          onclick='openModal("{{ layer.info_html() }}"); closeDropdown("{{ layer.id }}")'
                          role="menuitem"
                        >
                          <span class="w-5"><i class="fas fa-cog"></i></span>
                          <span>{{ translate["info"] }}</span>
                        </button>
                      </li>

                      <!-- Map para admin -->
                      <li>
                        {% if layer.published %}
                          <a
                            class="block px-3 py-2 hover:bg-gray-50 items-center space-x-2"
                            href='/maplayer/{{ layer.category.name }}:{{ layer.name }}'
                            target="_blank"
                            role="menuitem"
                            onclick='closeDropdown("{{ layer.id }}")'
                            title='{{ translate["map"] }}'
                          >
                            <span class="w-5"><i class="fas fa-map"></i></span>
                            <span>{{ translate["map"] }}</span>
                          </a>
                        {% else %}
                          <div
                            class="block w-full text-left px-3 py-2 items-center space-x-2 text-gray-400 cursor-not-allowed"
                            role="menuitem"
                            aria-disabled="true"
                            title='{{ translate["map"] }}'
                          >
                            <span class="w-5"><i class="fas fa-map"></i></span>
                            <span>{{ translate["map"] }}</span>
                          </div>
                        {% endif %}
                      </li>

                      <!-- Switch published -->
                      <li>
                        <a
                          class="block px-3 py-2 hover:bg-gray-50 items-center space-x-2"
                          href='/admin/catalog/layers/swichpublished/{{ layer.id }}'
                          role="menuitem"
                          onclick='closeDropdown("{{ layer.id }}")'
                          title='{{ translate["switch-published"] }}'
                        >
                          <span class="w-5">
                            {% if layer.published %}
                              <i class="far fa-check-square"></i>
                            {% else %}
                              <i class="far fa-square"></i>
                            {% endif %}
                          </span>
                          <span>{{ translate["switch-published"] }}</span>
                        </a>
                      </li>

                      <!-- Delete cache -->
                      <li>
                        <a
                          class="block px-3 py-2 hover:bg-gray-50 items-center space-x-2"
                          href='/admin/catalog/layers/delete_cache/{{ layer.id }}'
                          role="menuitem"
                          onclick='if(!confirm("Are you sure you want to erase the cache for this layer?")) return false; closeDropdown("{{ layer.id }}")'
                          title='{{ translate["delete-cache"] }}'
                        >
                          <span class="w-5"><i class="fas fa-eraser"></i></span>
                          <span>{{ translate["delete-cache"] }}</span>
                        </a>
                      </li>

                      <!-- Edit -->
                      <li>
                        <a
                          class="block px-3 py-2 hover:bg-gray-50 items-center space-x-2"
                          href='/admin/catalog/layers/edit/{{ layer.id }}'
                          role="menuitem"
                          onclick='closeDropdown("{{ layer.id }}")'
                          title='{{ translate["edit"] }}'
                        >
                          <span class="w-5"><i class="fas fa-pen"></i></span>
                          <span>{{ translate["edit"] }}</span>
                        </a>
                      </li>

                      <!-- Delete publication -->
                      <li>
                        <a
                          class="block px-3 py-2 hover:bg-red-50 text-red-600 items-center space-x-2"
                          href='/admin/catalog/layers/delete/{{ layer.id }}'
                          role="menuitem"
                          onclick="if(!confirm('{{ translate["confirm-delete-layer"] }}')) return false; closeDropdown('{{ layer.id }}')"
                          title='{{ translate["delete"] }}'
                        >
                          <span class="w-5"><i class="fas fa-trash"></i></span>
                          <span>{{ translate["delete"] }}</span>
                        </a>
                      </li>
                    {% endif %}
                  {% endif %}
                </ul>
              </div>
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
